<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="æ‹æ‰“æµ·æµªçš„ç¯€å¥ - ç„¡å°¾æ¸¯ä»»å‹™">
    <title>ğŸŒŠ æ‹æ‰“æµ·æµªçš„ç¯€å¥ä»»å‹™</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="ocean-background" aria-hidden="true">
        <div class="wave wave1"></div>
        <div class="wave wave2"></div>
        <div class="wave wave3"></div>
    </div>
    
    <div class="coastline" aria-hidden="true">
        <div class="dune dune-front"></div>
        <div class="dune dune-mid"></div>
        <div class="dune dune-back"></div>
        <div class="coastline-highlight"></div>
    </div>
    
    <div class="container">
        <div class="language-selector" id="language-selector">
            <button type="button" class="lang-toggle-btn" id="lang-toggle-btn" aria-label="é¸æ“‡èªè¨€">
                <span class="lang-icon">ğŸŒ</span>
                <span class="lang-current" id="lang-current">ç¹é«”ä¸­æ–‡</span>
                <span class="lang-arrow">â–¼</span>
            </button>
            <div class="lang-dropdown" id="lang-dropdown" style="display: none;">
                <button type="button" class="lang-option" data-lang="zh-TW">ç¹é«”ä¸­æ–‡</button>
                <button type="button" class="lang-option" data-lang="zh-CN">ç®€ä½“ä¸­æ–‡</button>
                <button type="button" class="lang-option" data-lang="en">English</button>
                <button type="button" class="lang-option" data-lang="ja">æ—¥æœ¬èª</button>
                <button type="button" class="lang-option" data-lang="ko">í•œêµ­ì–´</button>
            </div>
        </div>
        
        <header class="header">
            <a href="index.html" class="back-link" data-i18n="backToHome">â† è¿”å›é¦–é </a>
            <h1 class="title" data-i18n="mission9Title">ğŸŒŠ æ‹æ‰“æµ·æµªçš„ç¯€å¥ä»»å‹™</h1>
            <p class="subtitle" data-i18n="mission9Subtitle">ğŸ“ ç„¡å°¾æ¸¯ãƒ»ç¬¬ä¹é—œ</p>
        </header>
        
        <main id="main-content" class="content">
            <section class="card" aria-labelledby="mission9-title">
                <h2 id="mission9-title" data-i18n="mission9PageTitle">ç¬¬ä¹é—œï½œæ‹æ‰“æµ·æµªçš„ç¯€å¥ï¼ˆç„¡å°¾æ¸¯ï¼‰</h2>
                <p class="mission-intro" data-i18n="mission9PageIntro">åœ¨ç„¡å°¾æ¸¯çš„æµ·ç˜ï¼Œæ—…è¡Œè€…æœƒè¢« AI å¼•å°è·Ÿè‘—æµ·æµªçš„ç¯€å¥è‡ªç”±èˆå‹•ï¼Œé«”é©—è‡ªç„¶çš„ç¯€å¥ã€‚æ—…è¡Œè€…å¯ä»¥éŒ„ä¸‹è‡ªå·±çš„å‹•ä½œæˆ–æ„Ÿå—ï¼Œä¸¦ä¿å­˜ã€‚</p>
                
                <div class="mission-content">
                    <div class="whisper-container">
                        <!-- AI å¼•å°å€åŸŸ -->
                        <div class="ai-guide-area">
                            <div class="ai-avatar">ğŸŒŠ</div>
                            <div class="ai-message" id="ai-message">
                                <p data-i18n="mission9AIMessage">æº–å‚™å¥½äº†å—ï¼Ÿé»æ“Šã€Œé–‹å§‹å¼•å°ã€ä¾†é–‹å§‹é€™æ®µå…§åœ¨æ—…ç¨‹ã€‚</p>
                            </div>
                        </div>
                        
                        <!-- æ§åˆ¶æŒ‰éˆ•å€ -->
                        <div class="whisper-controls">
                            <button type="button" class="btn-whisper btn-start" id="btn-start-guide">
                                <span data-i18n="btnStartGuide">ğŸ¤ é–‹å§‹å¼•å°</span>
                            </button>
                            <button type="button" class="btn-whisper btn-stop" id="btn-stop-guide" style="display: none;">
                                <span data-i18n="btnStopGuide">â¸ï¸ æš«åœ</span>
                            </button>
                        </div>
                        
                        <!-- ä½¿ç”¨è€…å›æ‡‰å€åŸŸ -->
                        <div class="user-response-area" id="user-response-area" style="display: none;">
                            <h3 data-i18n="yourFeelings">ä½ çš„æ„Ÿå—</h3>
                            <div class="input-methods">
                                <button type="button" class="btn-input-method active" id="btn-voice-input" data-method="voice">
                                    <span data-i18n="voiceInput">ğŸ¤ èªéŸ³è¼¸å…¥</span>
                                </button>
                                <button type="button" class="btn-input-method" id="btn-text-input" data-method="text">
                                    <span data-i18n="textInput">âœï¸ æ–‡å­—è¼¸å…¥</span>
                                </button>
                            </div>
                            
                            <!-- èªéŸ³è¼¸å…¥ä»‹é¢ -->
                            <div class="voice-input-panel" id="voice-input-panel">
                                <div class="recording-indicator" id="recording-indicator" style="display: none;">
                                    <span class="recording-dot"></span>
                                    <span data-i18n="listening">æ­£åœ¨è†è½...</span>
                                </div>
                                <button type="button" class="btn-record" id="btn-record">
                                    <span data-i18n="btnStartSpeaking">ğŸ™ï¸ é–‹å§‹èªªè©±</span>
                                </button>
                                <div class="transcript-display" id="transcript-display"></div>
                            </div>
                            
                            <!-- æ–‡å­—è¼¸å…¥ä»‹é¢ -->
                            <div class="text-input-panel" id="text-input-panel" style="display: none;">
                                <textarea 
                                    id="text-response" 
                                    data-i18n-placeholder="textResponsePlaceholder"
                                    placeholder="è«‹åˆ†äº«ï¼šé€™ç¯€å¥å¸¶çµ¦ä½ ä»€éº¼æƒ…ç·’æˆ–æƒ³æ³•ï¼Ÿ"
                                    rows="4"
                                ></textarea>
                            </div>
                            
                            <button type="button" class="btn-submit" id="btn-submit-response" style="display: none;">
                                <span data-i18n="btnSubmitResponse">ğŸ’­ é€å‡ºæ„Ÿå—</span>
                            </button>
                        </div>
                        
                        <!-- AI åé¥‹å€åŸŸ -->
                        <div class="ai-feedback-area" id="ai-feedback-area" style="display: none;">
                            <div class="feedback-content" id="feedback-content"></div>
                        </div>
                        
                        <!-- éŒ„éŸ³èˆ‡ä¿å­˜å€åŸŸ -->
                        <div class="recording-save-area" id="recording-save-area" style="display: none;">
                            <h3 data-i18n="recordFeelings">ğŸ“ è¨˜éŒ„ä½ çš„æ„Ÿå—</h3>
                            <div class="recording-controls">
                                <button type="button" class="btn-record-feeling" id="btn-record-feeling">
                                    <span data-i18n="btnRecordFeeling">ğŸ™ï¸ éŒ„ä¸‹æ„Ÿå—</span>
                                </button>
                                <div class="recording-status" id="recording-status"></div>
                            </div>
                            <div class="save-controls">
                                <button type="button" class="btn-save" id="btn-save-note">
                                    <span data-i18n="btnSaveNote">ğŸ’¾ ä¿å­˜è‡³å¿ƒéˆç­†è¨˜</span>
                                </button>
                                <button type="button" class="btn-view-notes" id="btn-view-notes">
                                    <span data-i18n="btnViewNotes">ğŸ“– æŸ¥çœ‹å¿ƒéˆç­†è¨˜</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="qr-section card">
                <h3 data-i18n="scanQRNext">ğŸ“· æƒæ QR ç¢¼é€²å…¥ä¸‹ä¸€å€‹ä»»å‹™</h3>
                <p data-i18n="scanQRNextDesc">å®Œæˆæ­¤ä»»å‹™å¾Œï¼Œæƒæä¸‹ä¸€å€‹ä»»å‹™çš„ QR ç¢¼ç¹¼çºŒæ—…ç¨‹</p>
                <button type="button" class="btn-qr-scan" id="btn-scan-qr">
                    <span data-i18n="btnScanQR">ğŸ“· æƒæ QR ç¢¼</span>
                </button>
                <div id="qr-reader" style="display: none; margin-top: 20px;"></div>
            </section>
        </main>
    </div>
    
    <!-- å¿ƒéˆç­†è¨˜æ¨¡æ…‹è¦–çª— -->
    <div class="modal" id="notes-modal" style="display: none;">
        <div class="modal-content">
            <span class="modal-close" id="modal-close">&times;</span>
            <h2 data-i18n="mindNotes">ğŸ“– å¿ƒéˆç­†è¨˜</h2>
            <div class="notes-list" id="notes-list"></div>
        </div>
    </div>
    
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="i18n.js"></script>
    <script src="task-progress.js"></script>
    <script src="location-check.js"></script>
    <script src="esg-stats.js"></script>
    <script src="traveler-store.js"></script>
    <script src="task-script.js"></script>
    <script src="ai-dialogue.js"></script>
    <script src="mission9-script.js"></script>
    <script src="index-i18n.js"></script>
    <script>
        // é é¢è¼‰å…¥æ™‚æª¢æŸ¥ä»»å‹™è§£é–å’Œä½ç½®
        document.addEventListener('DOMContentLoaded', function() {
            const taskKey = 'mission9';
            
            // å»¶é²åŸ·è¡Œç¢ºä¿æ‰€æœ‰è…³æœ¬å·²è¼‰å…¥
            setTimeout(function() {
                // ç¢ºä¿å‡½æ•¸å·²è¼‰å…¥
                if (typeof window.isLocationVerified === 'undefined' || typeof window.blockTaskContent === 'undefined') {
                    console.error('[mission9.html] ä½ç½®æª¢æ¸¬å‡½æ•¸æœªè¼‰å…¥');
                    return;
                }
                
                // å…ˆæª¢æŸ¥ä»»å‹™æ˜¯å¦è§£é–
                if (typeof TaskProgress !== 'undefined' && TaskProgress.blockUnlockedTask && TaskProgress.blockUnlockedTask(taskKey)) {
                    return;
                }
                
                // æª¢æŸ¥ä½ç½®é©—è­‰
                if (!window.isLocationVerified(taskKey)) {
                    window.blockTaskContent(taskKey);
                }
            }, 200);
        });
    </script>
</body>
</html>

