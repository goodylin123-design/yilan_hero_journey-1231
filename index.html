<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="è¸ä¸Šå®œè˜­æµ·å²¸å†’éšªä¹‹æ—…ï¼Œæ¢ç´¢ç„¡ç›¡æµ·æ´‹ã€ç¥ç§˜å³¶å¶¼èˆ‡åˆºæ¿€çš„èˆªæµ·æ¢éšªã€‚">
    <title>æ“ºæ¸¡è˜­é™½è‹±é›„ä¹‹æ—…</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="ocean-background" aria-hidden="true">
        <div class="wave wave1"></div>
        <div class="wave wave2"></div>
        <div class="wave wave3"></div>
    </div>
    
    <!-- æµ·å²¸èˆ‡æ²™ä¸˜å‰æ™¯ï¼ˆç´”è£é£¾ç”¨ï¼‰ -->
    <div class="coastline" aria-hidden="true">
        <div class="dune dune-front"></div>
        <div class="dune dune-mid"></div>
        <div class="dune dune-back"></div>
        <div class="coastline-highlight"></div>
    </div>
    
    <div class="container">
        <header class="header">
            <h1 class="title">ğŸŒŠ æ“ºæ¸¡è˜­é™½è‹±é›„ä¹‹æ—…</h1>
            <p class="subtitle">è˜­é™½æµ·å²¸ãƒ»å…§åœ¨æˆé•·å‹ä¸‰é—œè‹±é›„æ—…ç¨‹</p>
        </header>
        
        <main id="main-content" class="content">
            <section class="card" aria-labelledby="hero-title">
                <h2 id="hero-title">å…§åœ¨æˆé•·å‹ä¸‰é—œè‹±é›„æ—…ç¨‹ï¼ˆå®œè˜­æµ·å²¸ï¼‰</h2>
                <p>æ²¿è‘—èœœæœˆç£åˆ°æƒ…äººç£çš„æµ·ç·šï¼Œè®“å¿ƒè·³èˆ‡æµ·é¢¨åŒæ­¥ï¼Œä¸€é—œä¸€é—œé•·å‡ºæ–°çš„è‡ªå·±ã€‚</p>
                
                <ol class="journey-steps">
                    <li><strong>ç¬¬ä¸€é—œï½œå•Ÿç¨‹ï¼šèœœæœˆç£æµ·ç˜</strong> â€” æ‰¾åˆ°ä½ çš„ã€Œå‡ºèˆªç†ç”±ã€ï¼Œå¯«ä¸‹æ­¤åˆ»çš„å‹‡æ°£å®£è¨€ã€‚</li>
                    <li><strong>ç¬¬äºŒé—œï½œè·¨è¶Šï¼šè˜­é™½ç´°é›¨èˆ‡æµ·é¢¨</strong> â€” ç›´é¢å…§å¿ƒçš„ç–‘æ…®ï¼Œåœ¨é¢¨é›¨ä¸­ç·´ç¿’ç©©ä½å‘¼å¸èˆ‡è…³æ­¥ã€‚</li>
                    <li><strong>ç¬¬ä¸‰é—œï½œå›æ­¸ï¼šæƒ…äººç£æ—¥å‡ºæ¸¯</strong> â€” æŠŠæ—…ç¨‹çš„æ´è¦‹æ”¶æŸï¼Œç‚ºè‡ªå·±é ’ç™¼ä¸€æšå‹‡æ°£ç« ï¼Œä¸¦åˆ†äº«çµ¦åŒä¼´ã€‚</li>
                </ol>

                <!-- è‹±é›„ä»»å‹™é¸æ“‡ -->
                <section class="hero-missions" aria-label="è‹±é›„ä»»å‹™é¸æ“‡">
                    <h3 class="hero-missions-title">é¸æ“‡ä»Šå¤©çš„è‹±é›„ä»»å‹™</h3>
                    <p class="hero-missions-subtitle">ä¾ç…§ç•¶ä¸‹çš„ç‹€æ…‹ï¼ŒæŒ‘ä¸€å€‹ä»»å‹™ï¼Œé–‹å§‹ä½ çš„å…§åœ¨æˆé•·æ—…ç¨‹ã€‚</p>
                    <div id="wave-sound-hint" style="text-align: center; padding: 10px; background: rgba(56, 189, 248, 0.1); border-radius: 10px; margin-bottom: 15px; color: #3B82F6; font-size: 0.9rem; display: none;">
                        <span id="hint-text">ğŸµ é»æ“Šé é¢ä»»æ„è™•å³å¯è½åˆ°ã€Œå¤©æ¸…å®œè˜­ã€èƒŒæ™¯éŸ³æ¨‚</span>
                        <br>
                        <button id="test-music-btn" style="margin-top: 10px; padding: 8px 20px; background: #3B82F6; color: white; border: none; border-radius: 20px; cursor: pointer; font-size: 0.85rem;">
                            ğŸµ æ¸¬è©¦æ’­æ”¾éŸ³æ¨‚
                        </button>
                    </div>

                    <div class="hero-missions-buttons" id="mission-buttons">
                        <a href="wave.html" class="mission-btn-link" data-task="wave">
                            <button type="button" class="mission-btn" data-mission="wave">
                                ğŸŒŠ æµ·é¢¨ä¸­çš„å‘¢å–ƒä»»å‹™
                                <span class="mission-location">ğŸ“ èœœæœˆç£</span>
                                <span class="mission-status" id="status-wave"></span>
                            </button>
                        </a>
                        <a href="rain.html" class="mission-btn-link" data-task="rain">
                            <button type="button" class="mission-btn" data-mission="rain">
                                ğŸŒ§ è˜­é™½ç´°é›¨é™ªä¼´ä»»å‹™
                                <span class="mission-location">ğŸ“ å£¯åœæ²™ä¸˜ç”Ÿæ…‹åœ’å€</span>
                                <span class="mission-status" id="status-rain"></span>
                            </button>
                        </a>
                        <a href="dawn.html" class="mission-btn-link" data-task="dawn">
                            <button type="button" class="mission-btn" data-mission="dawn">
                                ğŸŒ… æƒ…äººç£æ—¥å‡ºå‹‡æ°£ä»»å‹™
                                <span class="mission-location">ğŸ“ æƒ…äººç£</span>
                                <span class="mission-status" id="status-dawn"></span>
                            </button>
                        </a>
                    </div>
                    
                    <!-- ä»»å‹™é€²åº¦é¡¯ç¤º -->
                    <div class="task-progress-display" id="task-progress-display">
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="progress-bar"></div>
                        </div>
                        <p class="progress-text" id="progress-text">é€²åº¦ï¼š0%</p>
                    </div>

                    <div class="qr-scan-section">
                        <button type="button" class="btn-qr-scan" id="btn-scan-qr">
                            <span>ğŸ“· æƒæ QR ç¢¼é€²å…¥ä»»å‹™</span>
                        </button>
                        <div id="qr-reader" style="display: none; margin-top: 20px;"></div>
                    </div>
                </section>
                
                <div class="button-group">
                    <a href="wave.html" class="btn-link">
                        <button type="button" class="btn btn-primary">
                            <span class="btn-text">ğŸš¢ é–‹å§‹ç¬¬ä¸€é—œ</span>
                            <span class="btn-shine"></span>
                        </button>
                    </a>
                    
                    <a href="route.html" class="btn-link">
                        <button type="button" class="btn btn-secondary">
                            <span class="btn-text">ğŸ—ºï¸ æŸ¥çœ‹è·¯ç·š</span>
                            <span class="btn-shine"></span>
                        </button>
                    </a>
                    
                    <a href="music-player.html" class="btn-link">
                        <button type="button" class="btn btn-adventure">
                            <span class="btn-text">ğŸµ è‹±é›„éŸ³æ¨‚</span>
                            <span class="btn-shine"></span>
                        </button>
                    </a>
                    
                    <button type="button" class="btn btn-adventure" id="btn-view-notes" style="margin-top: 10px;">
                        <span class="btn-text">ğŸ“– å¿ƒéˆç­†è¨˜</span>
                        <span class="btn-shine"></span>
                    </button>
                </div>
            </section>
            
            <section class="features" aria-label="å†’éšªç‰¹è‰²">
                <article class="feature-card">
                    <div class="feature-icon">ğŸŒŠ</div>
                    <h3>å•Ÿç¨‹ãƒ»èœœæœˆç£</h3>
                    <p>åœ¨é‡‘è‰²æ²™ä¸˜èˆ‡æµ·é¢äº¤ç•Œï¼Œå¯«ä¸‹å•Ÿèˆªå®£è¨€ï¼Œé å‚™å¥½ç¬¬ä¸€æ­¥ã€‚</p>
                    <a href="wave.html" class="feature-link">é€²å…¥ä»»å‹™ â†’</a>
                </article>
                <article class="feature-card">
                    <div class="feature-icon">ğŸï¸</div>
                    <h3>è·¨è¶Šãƒ»è˜­é™½é¢¨é›¨</h3>
                    <p>æ„Ÿå—æ±åŒ—å­£é¢¨èˆ‡ç´°é›¨ï¼Œç·´ç¿’é¢å°ä¸ç¢ºå®šï¼Œæ‰¾åˆ°è‡ªå·±çš„æ­¥èª¿ã€‚</p>
                    <a href="rain.html" class="feature-link">é€²å…¥ä»»å‹™ â†’</a>
                </article>
                <article class="feature-card">
                    <div class="feature-icon">â›µ</div>
                    <h3>å›æ­¸ãƒ»æƒ…äººç£æ—¥å‡ºæ¸¯</h3>
                    <p>è¿æ¥æ™¨æ›¦ï¼Œæ•´ç†æ—…ç¨‹æ´è¦‹ï¼Œç‚ºè‡ªå·±é ’ç™¼å‹‡æ°£å¾½ç« ä¸¦åˆ†äº«æ•…äº‹ã€‚</p>
                    <a href="dawn.html" class="feature-link">é€²å…¥ä»»å‹™ â†’</a>
                </article>
            </section>
            
            <section class="features" aria-label="å†’éšªç‰¹è‰²">
                <article class="feature-card">
                    <div class="feature-icon">ğŸŒŠ</div>
                    <h3>å•Ÿç¨‹ãƒ»èœœæœˆç£</h3>
                    <p>åœ¨é‡‘è‰²æ²™ä¸˜èˆ‡æµ·é¢äº¤ç•Œï¼Œå¯«ä¸‹å•Ÿèˆªå®£è¨€ï¼Œé å‚™å¥½ç¬¬ä¸€æ­¥ã€‚</p>
                </article>
                <article class="feature-card">
                    <div class="feature-icon">ğŸï¸</div>
                    <h3>è·¨è¶Šãƒ»è˜­é™½é¢¨é›¨</h3>
                    <p>æ„Ÿå—æ±åŒ—å­£é¢¨èˆ‡ç´°é›¨ï¼Œç·´ç¿’é¢å°ä¸ç¢ºå®šï¼Œæ‰¾åˆ°è‡ªå·±çš„æ­¥èª¿ã€‚</p>
                </article>
                <article class="feature-card">
                    <div class="feature-icon">â›µ</div>
                    <h3>å›æ­¸ãƒ»æƒ…äººç£æ—¥å‡ºæ¸¯</h3>
                    <p>è¿æ¥æ™¨æ›¦ï¼Œæ•´ç†æ—…ç¨‹æ´è¦‹ï¼Œç‚ºè‡ªå·±é ’ç™¼å‹‡æ°£å¾½ç« ä¸¦åˆ†äº«æ•…äº‹ã€‚</p>
                </article>
            </section>
        </main>
    </div>
    
    <!-- å¿ƒéˆç­†è¨˜æ¨¡æ…‹è¦–çª— -->
    <div class="modal" id="notes-modal" style="display: none;">
        <div class="modal-content">
            <span class="modal-close" id="modal-close">&times;</span>
            <h2>ğŸ“– å¿ƒéˆç­†è¨˜</h2>
            <div class="notes-list" id="notes-list"></div>
        </div>
    </div>
    
    <!-- å¿ƒéˆç­†è¨˜æ¨¡æ…‹è¦–çª— -->
    <div class="modal" id="notes-modal" style="display: none;">
        <div class="modal-content">
            <span class="modal-close" id="modal-close">&times;</span>
            <h2>ğŸ“– å¿ƒéˆç­†è¨˜</h2>
            <div class="notes-list" id="notes-list"></div>
        </div>
    </div>
    
    <!-- QR ç¢¼æƒæåº« -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="task-progress.js"></script>
    <script src="script.js"></script>
    <script src="index-script.js"></script>
    
    <!-- è¼‰å…¥è¼•å¿«æµ·æ´‹éŸ³æ¨‚ç”Ÿæˆå™¨ -->
    <script src="hero-music.js"></script>
    <script>
        // é–‹æ”¾ç‰ˆæ¬Šçš„è¼•å¿«æµ·æ´‹éŸ³æ¨‚æ’­æ”¾å™¨ï¼ˆä½¿ç”¨ç”Ÿæˆçš„éŸ³æ¨‚ï¼‰
        let musicGenerator = null;
        let musicStarted = false;
        let hasUserInteracted = false;

        // åˆå§‹åŒ–ä¸¦æ’­æ”¾è¼•å¿«æµ·æ´‹éŸ³æ¨‚
        async function initAndPlayMusic() {
            if (!musicGenerator) {
                musicGenerator = new HeroMusicGenerator();
                const initialized = await musicGenerator.init();
                if (!initialized) {
                    console.error('âŒ ç„¡æ³•åˆå§‹åŒ–éŸ³æ¨‚ç”Ÿæˆå™¨');
                    return false;
                }
            }

            // å¦‚æœ AudioContext è¢«æš«åœï¼Œæ¢å¾©å®ƒ
            if (musicGenerator.audioContext.state === 'suspended') {
                await musicGenerator.audioContext.resume();
            }

            try {
                await musicGenerator.play();
                musicStarted = true;
                console.log('ğŸµ è¼•å¿«æµ·æ´‹éŸ³æ¨‚å·²é–‹å§‹æ’­æ”¾');
                hideMusicHint();
                return true;
            } catch (error) {
                console.error('âŒ æ’­æ”¾å¤±æ•—:', error);
                return false;
            }
        }

        // é¡¯ç¤ºéŸ³æ¨‚æç¤º
        function showMusicHint() {
            const hint = document.getElementById('wave-sound-hint');
            if (hint) {
                hint.innerHTML = '<span>ğŸµ é»æ“Šé é¢ä»»æ„è™•å³å¯è½åˆ°è¼•å¿«æµ·æ´‹èƒŒæ™¯éŸ³æ¨‚</span>';
                hint.style.display = 'block';
            }
        }

        // éš±è—éŸ³æ¨‚æç¤º
        function hideMusicHint() {
            const hint = document.getElementById('wave-sound-hint');
            if (hint) {
                hint.style.display = 'none';
            }
        }

        // è¨­ç½®ç”¨æˆ¶äº’å‹•ç›£è½
        function setupInteractionListener() {
            const startMusicOnInteraction = async () => {
                hasUserInteracted = true;
                console.log('ğŸ‘† ç”¨æˆ¶äº’å‹•ï¼Œé–‹å§‹æ’­æ”¾éŸ³æ¨‚');
                
                const success = await initAndPlayMusic();
                if (!success) {
                    showMusicHint();
                }
                
                // ç§»é™¤äº‹ä»¶ç›£è½å™¨
                document.removeEventListener('click', startMusicOnInteraction);
                document.removeEventListener('touchstart', startMusicOnInteraction);
                document.removeEventListener('keydown', startMusicOnInteraction);
                document.removeEventListener('mousemove', startMusicOnInteraction);
                document.removeEventListener('scroll', startMusicOnInteraction);
            };

            document.addEventListener('click', startMusicOnInteraction, { once: true });
            document.addEventListener('touchstart', startMusicOnInteraction, { once: true });
            document.addEventListener('keydown', startMusicOnInteraction, { once: true });
            document.addEventListener('mousemove', startMusicOnInteraction, { once: true });
            document.addEventListener('scroll', startMusicOnInteraction, { once: true });
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸ“„ é é¢å·²è¼‰å…¥');
            
            // è¨­ç½®äº’å‹•ç›£è½
            setupInteractionListener();
            
            // å˜—è©¦è‡ªå‹•æ’­æ”¾
            setTimeout(async () => {
                if (!musicStarted) {
                    const success = await initAndPlayMusic();
                    if (!success) {
                        showMusicHint();
                    }
                }
            }, 1000);
            
            // å¦‚æœ 3 ç§’å¾Œé‚„æ²’æ’­æ”¾ï¼Œé¡¯ç¤ºæç¤º
            setTimeout(() => {
                if (!musicStarted) {
                    showMusicHint();
                }
            }, 3000);
        });
    </script>
    <script>
        // ä¸»é é¢è‡ªå‹•æ’­æ”¾æµ·æµªèƒŒæ™¯éŸ³
        let waveSoundGenerator = null;
        let waveSoundSource = null;
        let waveSoundGain = null;
        let audioContext = null;
        let isWaveSoundPlaying = false;

        function createWaveSound() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }

            // å¦‚æœå·²ç¶“åœ¨æ’­æ”¾ï¼Œä¸é‡è¤‡å‰µå»º
            if (isWaveSoundPlaying) {
                return;
            }

            try {
                // ç”Ÿæˆæµ·æµªèƒŒæ™¯éŸ³ï¼ˆæŒçºŒå¾ªç’°ï¼‰
                const bufferSize = audioContext.sampleRate * 2; // 2 ç§’ç·©è¡
                const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
                const data = buffer.getChannelData(0);

                // ç”Ÿæˆæµ·æµªèˆ¬çš„ç™½å™ªéŸ³ï¼ˆä½¿ç”¨æ›´è‡ªç„¶çš„ç®—æ³•ï¼‰
                for (let i = 0; i < bufferSize; i++) {
                    // å¤šå±¤å™ªéŸ³å‰µé€ æ›´è‡ªç„¶çš„æµ·æµªè²
                    const noise1 = (Math.random() * 2 - 1) * 0.1;
                    const noise2 = (Math.random() * 2 - 1) * 0.05;
                    // æ·»åŠ ç·©æ…¢çš„èµ·ä¼æ¨¡æ“¬æµ·æµª
                    const wave = Math.sin(i / bufferSize * Math.PI * 4) * 0.02;
                    data[i] = noise1 + noise2 + wave;
                }

                const source = audioContext.createBufferSource();
                source.buffer = buffer;
                source.loop = true;

                // ä½é€šæ¿¾æ³¢å™¨æ¨¡æ“¬æµ·æµªè²
                const filter = audioContext.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.value = 500; // æ›´æŸ”å’Œçš„é »ç‡
                filter.Q.value = 1;

                // éŸ³é‡æ§åˆ¶ï¼ˆé©ä¸­éŸ³é‡ï¼Œç¢ºä¿å¯è½è¦‹ï¼‰
                const gainNode = audioContext.createGain();
                gainNode.gain.value = 0.35; // æé«˜éŸ³é‡ç¢ºä¿ç”¨æˆ¶èƒ½è½åˆ°

                source.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(audioContext.destination);

                // ä¿å­˜å¼•ç”¨ä»¥ä¾¿å¾ŒçºŒæ§åˆ¶
                waveSoundGenerator = { audioContext, source, gainNode };
                waveSoundSource = source;
                waveSoundGain = gainNode;
                isWaveSoundPlaying = true;

                // å•Ÿå‹• AudioContextï¼ˆå¦‚æœè¢«æš«åœï¼‰
                if (audioContext.state === 'suspended') {
                    audioContext.resume().then(() => {
                        try {
                            source.start(0);
                            console.log('æµ·æµªè²å·²é–‹å§‹æ’­æ”¾');
                        } catch (error) {
                            console.error('æ’­æ”¾å¤±æ•—:', error);
                            isWaveSoundPlaying = false;
                        }
                    }).catch(error => {
                        console.error('æ¢å¾© AudioContext å¤±æ•—:', error);
                        isWaveSoundPlaying = false;
                    });
                } else {
                    try {
                        source.start(0);
                        console.log('æµ·æµªè²å·²é–‹å§‹æ’­æ”¾');
                    } catch (error) {
                        console.error('æ’­æ”¾å¤±æ•—:', error);
                        isWaveSoundPlaying = false;
                    }
                }
            } catch (error) {
                console.error('ç„¡æ³•å‰µå»ºæµ·æµªè²:', error);
                isWaveSoundPlaying = false;
            }
        }

        // åˆå§‹åŒ– AudioContext ä¸¦å˜—è©¦è‡ªå‹•æ’­æ”¾
        async function initAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            // å˜—è©¦ç«‹å³æ’­æ”¾ï¼ˆå¦‚æœç€è¦½å™¨å…è¨±ï¼‰
            try {
                if (audioContext.state === 'suspended') {
                    await audioContext.resume();
                }
                if (!isWaveSoundPlaying) {
                    createWaveSound();
                }
            } catch (error) {
                console.log('è‡ªå‹•æ’­æ”¾è¢«é˜»æ­¢ï¼Œç­‰å¾…ç”¨æˆ¶äº’å‹•');
            }
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ– AudioContext
        document.addEventListener('DOMContentLoaded', () => {
            initAudioContext();
        });

        // ç”¨æˆ¶ç¬¬ä¸€æ¬¡äº’å‹•æ™‚é–‹å§‹æ’­æ”¾
        const startWaveSoundOnInteraction = async () => {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            try {
                if (audioContext.state === 'suspended') {
                    await audioContext.resume();
                }
                if (!isWaveSoundPlaying) {
                    createWaveSound();
                    // éš±è—æç¤º
                    const hint = document.getElementById('wave-sound-hint');
                    if (hint) {
                        hint.style.display = 'none';
                    }
                }
            } catch (error) {
                console.error('ç„¡æ³•æ’­æ”¾æµ·æµªè²:', error);
            }
            
            // ç§»é™¤äº‹ä»¶ç›£è½å™¨ï¼ˆåªåŸ·è¡Œä¸€æ¬¡ï¼‰
            document.removeEventListener('click', startWaveSoundOnInteraction);
            document.removeEventListener('touchstart', startWaveSoundOnInteraction);
            document.removeEventListener('keydown', startWaveSoundOnInteraction);
            document.removeEventListener('mousemove', startWaveSoundOnInteraction);
            document.removeEventListener('scroll', startWaveSoundOnInteraction);
        };

        // ç›£è½å¤šç¨®ç”¨æˆ¶äº’å‹•äº‹ä»¶ï¼ˆå¢åŠ è§¸ç™¼æ©Ÿæœƒï¼‰
        document.addEventListener('click', startWaveSoundOnInteraction, { once: true });
        document.addEventListener('touchstart', startWaveSoundOnInteraction, { once: true });
        document.addEventListener('keydown', startWaveSoundOnInteraction, { once: true });
        document.addEventListener('mousemove', startWaveSoundOnInteraction, { once: true });

        // å˜—è©¦è‡ªå‹•æ’­æ”¾ï¼ˆæŸäº›ç€è¦½å™¨å¯èƒ½å…è¨±ï¼‰
        setTimeout(async () => {
            if (audioContext) {
                try {
                    if (audioContext.state === 'suspended') {
                        await audioContext.resume();
                    }
                    if (audioContext.state === 'running' && !isWaveSoundPlaying) {
                        createWaveSound();
                        // éš±è—æç¤º
                        const hint = document.getElementById('wave-sound-hint');
                        if (hint) {
                            hint.style.display = 'none';
                        }
                    } else if (!isWaveSoundPlaying) {
                        // é¡¯ç¤ºæç¤º
                        const hint = document.getElementById('wave-sound-hint');
                        if (hint) {
                            hint.style.display = 'block';
                        }
                    }
                } catch (error) {
                    console.log('è‡ªå‹•æ’­æ”¾å¤±æ•—ï¼Œç­‰å¾…ç”¨æˆ¶äº’å‹•:', error);
                    // é¡¯ç¤ºæç¤º
                    const hint = document.getElementById('wave-sound-hint');
                    if (hint) {
                        hint.style.display = 'block';
                    }
                }
            }
        }, 1500);

        // æä¾›åœæ­¢æµ·æµªè²çš„å‡½æ•¸ï¼ˆå¯é¸ï¼‰
        function stopWaveSound() {
            if (waveSoundSource && waveSoundGain && isWaveSoundPlaying) {
                waveSoundGain.gain.linearRampToValueAtTime(0, audioContext.currentTime + 1);
                setTimeout(() => {
                    try {
                        waveSoundSource.stop();
                        isWaveSoundPlaying = false;
                    } catch (e) {}
                }, 1000);
            }
        }
    </script>
    <script>
        // æ›´æ–°ä¸»é é¢çš„ä»»å‹™é€²åº¦é¡¯ç¤º
        document.addEventListener('DOMContentLoaded', () => {
            function updateTaskProgress() {
                const progress = TaskProgress.getTaskProgress();
                const percentage = TaskProgress.getProgressPercentage();
                
                // æ›´æ–°é€²åº¦æ¢
                const progressBar = document.getElementById('progress-bar');
                const progressText = document.getElementById('progress-text');
                if (progressBar) {
                    progressBar.style.width = percentage + '%';
                }
                if (progressText) {
                    progressText.textContent = `é€²åº¦ï¼š${percentage}% (${progress.completed.length}/3)`;
                }
                
                // æ›´æ–°æ¯å€‹ä»»å‹™æŒ‰éˆ•çš„ç‹€æ…‹
                ['wave', 'rain', 'dawn'].forEach(taskKey => {
                    const status = TaskProgress.showTaskLockStatus(taskKey);
                    const statusEl = document.getElementById(`status-${taskKey}`);
                    const btnLink = document.querySelector(`[data-task="${taskKey}"]`);
                    const btn = btnLink?.querySelector('.mission-btn');
                    
                    if (statusEl) {
                        statusEl.textContent = status.message;
                        statusEl.className = 'mission-status ' + status.status;
                    }
                    
                    if (btnLink && btn) {
                        if (status.status === 'locked') {
                            btnLink.style.pointerEvents = 'none';
                            btn.style.opacity = '0.6';
                            btn.style.cursor = 'not-allowed';
                            btnLink.href = 'javascript:void(0)';
                            btnLink.addEventListener('click', (e) => {
                                e.preventDefault();
                                alert(`éœ€è¦å…ˆå®Œæˆ ${status.requiredTask} æ‰èƒ½é€²å…¥æ­¤ä»»å‹™`);
                            });
                        } else {
                            btnLink.style.pointerEvents = 'auto';
                            btn.style.opacity = '1';
                            btn.style.cursor = 'pointer';
                            btnLink.href = `${taskKey}.html`;
                        }
                    }
                });
            }
            
            // åˆå§‹æ›´æ–°
            updateTaskProgress();
            
            // ç›£è½ä»»å‹™å®Œæˆäº‹ä»¶
            window.addEventListener('taskCompleted', () => {
                updateTaskProgress();
            });
        });
    </script>
</body>
</html>



