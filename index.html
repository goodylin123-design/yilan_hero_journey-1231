<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="踏上宜蘭海岸冒險之旅，探索無盡海洋、神秘島嶼與刺激的航海探險。">
    <title>擺渡蘭陽英雄之旅</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="ocean-background" aria-hidden="true">
        <div class="wave wave1"></div>
        <div class="wave wave2"></div>
        <div class="wave wave3"></div>
    </div>
    
    <!-- 海岸與沙丘前景（純裝飾用） -->
    <div class="coastline" aria-hidden="true">
        <div class="dune dune-front"></div>
        <div class="dune dune-mid"></div>
        <div class="dune dune-back"></div>
        <div class="coastline-highlight"></div>
    </div>
    
    <div class="container">
        <header class="header">
            <h1 class="title">🌊 擺渡蘭陽英雄之旅</h1>
            <p class="subtitle">蘭陽海岸・內在成長型三關英雄旅程</p>
        </header>
        
        <main id="main-content" class="content">
            <section class="card" aria-labelledby="hero-title">
                <h2 id="hero-title">內在成長型三關英雄旅程（宜蘭海岸）</h2>
                <p>沿著蜜月灣到情人灣的海線，讓心跳與海風同步，一關一關長出新的自己。</p>
                
                <ol class="journey-steps">
                    <li><strong>第一關｜啟程：蜜月灣海灘</strong> — 找到你的「出航理由」，寫下此刻的勇氣宣言。</li>
                    <li><strong>第二關｜跨越：蘭陽細雨與海風</strong> — 直面內心的疑慮，在風雨中練習穩住呼吸與腳步。</li>
                    <li><strong>第三關｜回歸：情人灣日出港</strong> — 把旅程的洞見收束，為自己頒發一枚勇氣章，並分享給同伴。</li>
                </ol>

                <!-- 英雄任務選擇 -->
                <section class="hero-missions" aria-label="英雄任務選擇">
                    <h3 class="hero-missions-title">選擇今天的英雄任務</h3>
                    <p class="hero-missions-subtitle">依照當下的狀態，挑一個任務，開始你的內在成長旅程。</p>

                    <div class="hero-missions-buttons" id="mission-buttons">
                        <a href="wave.html" class="mission-btn-link" data-task="wave">
                            <button type="button" class="mission-btn" data-mission="wave">
                                🌊 海風中的呢喃任務
                                <span class="mission-location">📍 蜜月灣</span>
                                <span class="mission-status" id="status-wave"></span>
                            </button>
                        </a>
                        <a href="rain.html" class="mission-btn-link" data-task="rain">
                            <button type="button" class="mission-btn" data-mission="rain">
                                🌧 蘭陽細雨陪伴任務
                                <span class="mission-location">📍 壯圍沙丘生態園區</span>
                                <span class="mission-status" id="status-rain"></span>
                            </button>
                        </a>
                        <a href="dawn.html" class="mission-btn-link" data-task="dawn">
                            <button type="button" class="mission-btn" data-mission="dawn">
                                🌅 情人灣日出勇氣任務
                                <span class="mission-location">📍 情人灣</span>
                                <span class="mission-status" id="status-dawn"></span>
                            </button>
                        </a>
                    </div>
                    
                    <!-- 任務進度顯示 -->
                    <div class="task-progress-display" id="task-progress-display">
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="progress-bar"></div>
                        </div>
                        <p class="progress-text" id="progress-text">進度：0%</p>
                    </div>

                    <div class="qr-scan-section">
                        <button type="button" class="btn-qr-scan" id="btn-scan-qr">
                            <span>📷 掃描 QR 碼進入任務</span>
                        </button>
                        <div id="qr-reader" style="display: none; margin-top: 20px;"></div>
                    </div>
                </section>
                
                <div class="button-group">
                    <a href="wave.html" class="btn-link">
                        <button type="button" class="btn btn-primary">
                            <span class="btn-text">🚢 開始第一關</span>
                            <span class="btn-shine"></span>
                        </button>
                    </a>
                    
                    <a href="route.html" class="btn-link">
                        <button type="button" class="btn btn-secondary">
                            <span class="btn-text">🗺️ 查看路線</span>
                            <span class="btn-shine"></span>
                        </button>
                    </a>
                    
                    <a href="music-player.html" class="btn-link">
                        <button type="button" class="btn btn-adventure">
                            <span class="btn-text">🎵 英雄音樂</span>
                            <span class="btn-shine"></span>
                        </button>
                    </a>
                    
                    <button type="button" class="btn btn-adventure" id="btn-view-notes" style="margin-top: 10px;">
                        <span class="btn-text">📖 心靈筆記</span>
                        <span class="btn-shine"></span>
                    </button>
                </div>
            </section>
            
            <section class="features" aria-label="冒險特色">
                <article class="feature-card">
                    <div class="feature-icon">🌊</div>
                    <h3>啟程・蜜月灣</h3>
                    <p>在金色沙丘與海面交界，寫下啟航宣言，預備好第一步。</p>
                    <a href="wave.html" class="feature-link">進入任務 →</a>
                </article>
                <article class="feature-card">
                    <div class="feature-icon">🏝️</div>
                    <h3>跨越・蘭陽風雨</h3>
                    <p>感受東北季風與細雨，練習面對不確定，找到自己的步調。</p>
                    <a href="rain.html" class="feature-link">進入任務 →</a>
                </article>
                <article class="feature-card">
                    <div class="feature-icon">⛵</div>
                    <h3>回歸・情人灣日出港</h3>
                    <p>迎接晨曦，整理旅程洞見，為自己頒發勇氣徽章並分享故事。</p>
                    <a href="dawn.html" class="feature-link">進入任務 →</a>
                </article>
            </section>
            
            <section class="features" aria-label="冒險特色">
                <article class="feature-card">
                    <div class="feature-icon">🌊</div>
                    <h3>啟程・蜜月灣</h3>
                    <p>在金色沙丘與海面交界，寫下啟航宣言，預備好第一步。</p>
                </article>
                <article class="feature-card">
                    <div class="feature-icon">🏝️</div>
                    <h3>跨越・蘭陽風雨</h3>
                    <p>感受東北季風與細雨，練習面對不確定，找到自己的步調。</p>
                </article>
                <article class="feature-card">
                    <div class="feature-icon">⛵</div>
                    <h3>回歸・情人灣日出港</h3>
                    <p>迎接晨曦，整理旅程洞見，為自己頒發勇氣徽章並分享故事。</p>
                </article>
            </section>
        </main>
    </div>
    
    <!-- 心靈筆記模態視窗 -->
    <div class="modal" id="notes-modal" style="display: none;">
        <div class="modal-content">
            <span class="modal-close" id="modal-close">&times;</span>
            <h2>📖 心靈筆記</h2>
            <div class="notes-list" id="notes-list"></div>
        </div>
    </div>
    
    <!-- 心靈筆記模態視窗 -->
    <div class="modal" id="notes-modal" style="display: none;">
        <div class="modal-content">
            <span class="modal-close" id="modal-close">&times;</span>
            <h2>📖 心靈筆記</h2>
            <div class="notes-list" id="notes-list"></div>
        </div>
    </div>
    
    <!-- QR 碼掃描庫 -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="task-progress.js"></script>
    <script src="hero-music.js"></script>
    <script src="script.js"></script>
    <script src="index-script.js"></script>
    <script>
        // 主頁面自動播放海浪背景音
        let waveSoundGenerator = null;
        let waveSoundSource = null;
        let waveSoundGain = null;

        async function initWaveSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // 生成海浪背景音（持續循環）
                const bufferSize = audioContext.sampleRate * 2; // 2 秒緩衝
                const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
                const data = buffer.getChannelData(0);

                // 生成海浪般的白噪音
                for (let i = 0; i < bufferSize; i++) {
                    data[i] = (Math.random() * 2 - 1) * 0.05; // 降低音量
                }

                const source = audioContext.createBufferSource();
                source.buffer = buffer;
                source.loop = true;

                // 低通濾波器模擬海浪聲
                const filter = audioContext.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.value = 600; // 更柔和的頻率
                filter.Q.value = 1;

                // 音量控制（輕微音量）
                const gainNode = audioContext.createGain();
                gainNode.gain.value = 0.15; // 輕微音量

                source.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(audioContext.destination);

                // 保存引用以便後續控制
                waveSoundGenerator = { audioContext, source, gainNode };
                waveSoundSource = source;
                waveSoundGain = gainNode;

                // 嘗試播放（可能需要用戶互動）
                try {
                    source.start(0);
                } catch (error) {
                    // 如果無法自動播放，等待用戶互動
                    console.log('需要用戶互動才能播放音訊');
                    
                    // 添加一個隱藏的播放按鈕或等待用戶點擊
                    const playOnInteraction = () => {
                        if (audioContext.state === 'suspended') {
                            audioContext.resume().then(() => {
                                source.start(0);
                            });
                        } else {
                            source.start(0);
                        }
                        document.removeEventListener('click', playOnInteraction);
                        document.removeEventListener('touchstart', playOnInteraction);
                    };
                    
                    document.addEventListener('click', playOnInteraction, { once: true });
                    document.addEventListener('touchstart', playOnInteraction, { once: true });
                }
            } catch (error) {
                console.error('無法初始化海浪聲:', error);
            }
        }

        // 頁面載入時初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 延遲一點再播放，讓頁面先載入
            setTimeout(() => {
                initWaveSound();
            }, 500);
        });

        // 提供停止海浪聲的函數（可選）
        function stopWaveSound() {
            if (waveSoundSource && waveSoundGain) {
                waveSoundGain.gain.linearRampToValueAtTime(0, waveSoundGenerator.audioContext.currentTime + 1);
                setTimeout(() => {
                    try {
                        waveSoundSource.stop();
                    } catch (e) {}
                }, 1000);
            }
        }
    </script>
    <script>
        // 更新主頁面的任務進度顯示
        document.addEventListener('DOMContentLoaded', () => {
            function updateTaskProgress() {
                const progress = TaskProgress.getTaskProgress();
                const percentage = TaskProgress.getProgressPercentage();
                
                // 更新進度條
                const progressBar = document.getElementById('progress-bar');
                const progressText = document.getElementById('progress-text');
                if (progressBar) {
                    progressBar.style.width = percentage + '%';
                }
                if (progressText) {
                    progressText.textContent = `進度：${percentage}% (${progress.completed.length}/3)`;
                }
                
                // 更新每個任務按鈕的狀態
                ['wave', 'rain', 'dawn'].forEach(taskKey => {
                    const status = TaskProgress.showTaskLockStatus(taskKey);
                    const statusEl = document.getElementById(`status-${taskKey}`);
                    const btnLink = document.querySelector(`[data-task="${taskKey}"]`);
                    const btn = btnLink?.querySelector('.mission-btn');
                    
                    if (statusEl) {
                        statusEl.textContent = status.message;
                        statusEl.className = 'mission-status ' + status.status;
                    }
                    
                    if (btnLink && btn) {
                        if (status.status === 'locked') {
                            btnLink.style.pointerEvents = 'none';
                            btn.style.opacity = '0.6';
                            btn.style.cursor = 'not-allowed';
                            btnLink.href = 'javascript:void(0)';
                            btnLink.addEventListener('click', (e) => {
                                e.preventDefault();
                                alert(`需要先完成 ${status.requiredTask} 才能進入此任務`);
                            });
                        } else {
                            btnLink.style.pointerEvents = 'auto';
                            btn.style.opacity = '1';
                            btn.style.cursor = 'pointer';
                            btnLink.href = `${taskKey}.html`;
                        }
                    }
                });
            }
            
            // 初始更新
            updateTaskProgress();
            
            // 監聽任務完成事件
            window.addEventListener('taskCompleted', () => {
                updateTaskProgress();
            });
        });
    </script>
</body>
</html>



